<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="logistics.work.models.dao.WorkDao">
    <select id="queryWorkByPage" parameterType="java.util.Map"
            resultType="logistics.work.models.dto.ShowWorkAuditConditionDto">
        select *
        from
        (select
        wp.id,
        IFNULL(sc.`name`,'已通过')as audit_status,
        wp.work_name,
        wp.work_content,
        wp.work_instructor,
        wp.work_minutes,
        'old' as flag
        from work_pool as wp
        left join work_audit as wad
        on wp.id=wad.origin_work_id
        left join sys_config as sc
        on wad.audit_status=sc.`code`
        where user_id=#{userId}
        union
        select
        wad.id,
        sc.name as audit_status,
        wad.work_name,
        wad.work_content,
        wad.work_instructor,
        wad.work_minutes,
        'new' as flag
        from work_audit as wad
        left join sys_config as sc
        on wad.audit_status=sc.`code`
        where wad.work_user_id=#{userId} and wad.origin_work_id is null
        order by audit_status desc) as a
        <where>
            <if test="workName!=null">
                work_name=#{workName}
            </if>
        </where>
        limit #{pageStart},#{pageSize}
    </select>
    <select id="queryWorkCount" parameterType="java.util.Map"
            resultType="Integer">
        select count(*)
        from
        (select
        wp.id,
        IFNULL(sc.`name`,'已通过')as audit_status,
        wp.work_name,
        wp.work_content,
        wp.work_instructor,
        wp.work_minutes,
        'old' as flag
        from work_pool as wp
        left join work_audit as wad
        on wp.id=wad.origin_work_id
        left join sys_config as sc
        on wad.audit_status=sc.`code`
        where user_id=#{userId}
        union
        select
        wad.id,
        sc.name as audit_status,
        wad.work_name,
        wad.work_content,
        wad.work_instructor,
        wad.work_minutes,
        'new' as flag
        from work_audit as wad
        left join sys_config as sc
        on wad.audit_status=sc.`code`
        where wad.work_user_id=#{userId} and wad.origin_work_id is null
        ) as a
        <where>
            <if test="workName!=null">
                work_name=#{workName}
            </if>
        </where>
    </select>
    <select id="leaderQueryWorkByPage" parameterType="java.util.Map" resultType="logistics.work.models.domain.WorkPool">
        select
        wp.id,
        wp.work_name,
        wp.work_content,
        wp.work_instructor,
        wp.work_minutes,
        `user`.username
        from work_pool as wp
        LEFT JOIN `user`
        on `user`.id=wp.user_id
        <where>
            wp.work_from='w3'
            <if test="employeeId!=null">
                and wp.user_id=#{employeeId}
            </if>
            <if test="workName!=null">
                and wp.work_name like "%"#{workName}"%"
            </if>
        </where>
        limit #{pageStart},#{pageSize}
    </select>
    <select id="leaderQueryWorkCount" parameterType="java.util.Map" resultType="Integer">
        select
        count(*)
        from work_pool as wp
        <where>
            <if test="employeeId!=null">
                wp.user_id=#{employeeId}
            </if>
            <if test="workName!=null">
                and wp.work_name like "%"#{workName}"%"
            </if>
        </where>
    </select>
</mapper>
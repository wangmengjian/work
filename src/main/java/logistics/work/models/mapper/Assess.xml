<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="logistics.work.models.dao.AssessDao">
    <select id="queryAllAssess" parameterType="java.util.Map" resultType="logistics.work.models.dto.ShowAssessDto">
        select
        wsd.id,
        sc1.name as finish_status,
        wp.work_name,
        wp.work_content,
        sc.name as workFrom,
        wp.work_minutes,
        ws.date as beginTime,
        wsd.finish_time,
        wa.assess_grade,
        employee.emp_name
        from work_schedule_detail as wsd
        left join work_pool as wp
        on wp.id=wsd.work_id
        left join work_assess as wa
        on wsd.id=wa.schedule_detail_id
        left join work_schedule as ws
        on ws.id=wsd.schedule_id
        left join `user`
        on ws.user_id=`user`.id
        left join employee
        on `user`.employee_id=employee.id
        left join sys_config as sc
        on sc.`code`=wp.work_from
        left join sys_config as sc1
        on sc1.`code`=wsd.finish_status
        <where>
            <if test="assessGrade!=null">
                assess_grade like #{assessGrade}
            </if>
            <if test="employeeId!=null">
                and employee_id=#{employeeId}
            </if>
            <if test="finishStatus!=null">
                and finish_status=#{finishStatus}
            </if>
            <if test="workName!=null">
                and wp.work_name like "%"#{workName}"%"
            </if>
            <if test="beginTime!=null">
                and ws.date>#{beginTime}
            </if>
            <if test="endTime!=null">
                and #{endTime}>finish_time
            </if>
        </where>
        order by assess_time desc
        limit #{pageStart},#{pageSize}
    </select>
    <select id="queryAllAssessCount" resultType="Integer" parameterType="java.util.Map">
        select count(*)
        from work_schedule_detail as wsd
        left join work_pool as wp
        on wp.id=wsd.work_id
        left join work_assess as wa
        on wsd.id=wa.schedule_detail_id
        left join work_schedule as ws
        on ws.id=wsd.schedule_id
        left join `user`
        on ws.user_id=`user`.id
        left join employee
        on `user`.employee_id=employee.id
        left join sys_config as sc
        on sc.`code`=wp.work_from
        left join sys_config as sc1
        on sc1.`code`=wsd.finish_status
        <where>
            <if test="assessGrade!=null">
                assess_grade like #{assessGrade}
            </if>
            <if test="employeeId!=null">
                and employee_id=#{employeeId}
            </if>
            <if test="finishStatus!=null">
                and finish_status=#{finishStatus}
            </if>
            <if test="workName!=null">
                and wp.work_name like "%"#{workName}"%"
            </if>
            <if test="beginTime!=null">
                and ws.date>#{beginTime}
            </if>
            <if test="endTime!=null">
                and #{endTime}>finish_time
            </if>
        </where>
    </select>
</mapper>